<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="black">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coolio Web</title>
  <link rel="icon" href="img/logo.png" type="image/png">
  <link rel="stylesheet" href="css/index.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
<link href="https://fonts.googleapis.com/css2?family=Funnel+Sans:ital,wght@0,300..800;1,300..800&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Titan+One&display=swap" rel="stylesheet">
</head>
<script src="static/uv/uv.bundle.js"></script>
  <script src="static/uv/uv.config.js"></script>
  <script src="static/register-sw.js"></script>
  <script src="static/iframe.js"></script>
<body>
  <div class="container">
    <div class="tabs" id="tabs"></div>
    <div class="url-bar-wrapper">
      <button class="nav-button" id="backBtn">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="nav-button" id="forwardBtn">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="nav-button" id="reloadBtn">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 10C22 10 19.995 7.26822 18.3662 5.63824C16.7373 4.00827 14.4864 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21C16.1031 21 19.5649 18.2543 20.6482 14.5M22 10V4M22 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <input id="url-input" class="url-bar" placeholder="Search or enter a URL.">
      <button class="more-button" id="moreButton">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 6C12.5523 6 13 5.55228 13 5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5C11 5.5523 11.4477 6 12 6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 20C12.5523 20 13 19.5523 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.5523 11.4477 20 12 20Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="dropdown" id="dropdownMenu">
  <button id="newTabBtn">
    <span class="material-symbols-outlined dropdown-icon">add</span>
    New Tab
  </button>

  <div class="divider"></div>

  <button id="fullscreenBtn" title="Fullscreen">
    <span class="material-symbols-outlined dropdown-icon">fullscreen</span>
    Fullscreen
  </button>

  <button id="gamesBtn" title="Games">
    <span class="material-symbols-outlined dropdown-icon">sports_esports</span>
    Games
  </button>

  <button id="installAppBtn">
    <span class="material-symbols-outlined dropdown-icon">download</span>
    Download App
  </button>

  <div class="divider"></div>

  <button id="settingsBtn">
    <span class="material-symbols-outlined dropdown-icon">settings</span>
    Settings
  </button>
</div>
    <div class="iframe-container" id="iframeContainer"></div>
  </div>
  <script>
if ('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');
const customIcons = {
  'coolio://new':      'img/logo.png',
  'coolio://games':    'img/games.png',
  'coolio://settings': 'img/settings.png'
};
let deferredPrompt,
  tabs = JSON.parse(localStorage.getItem('tabs')) || [{ name: 'New Tab', url: 'coolio://new', icon: customIcons['coolio://new'] }],
  activeIndex = +localStorage.getItem('activeTab') || 0,
  iframeElements = [];
const $ = id => document.getElementById(id);
const tabsContainer = $('tabs'), urlInput = $('url-input'), iframeContainer = $('iframeContainer');
function formatURL(input) {
  if (input.startsWith('coolio://')) return input;
  try { return new URL(input).href; }
  catch { return input.includes('.') ? 'https://' + input : 'https://duckduckgo.com/?q=' + encodeURIComponent(input); }
}
function createIframe(tab, idx) {
  const iframe = document.createElement('iframe');
  if (tab.url === 'coolio://new') iframe.src = 'newtab.html';
  else if (tab.url === 'coolio://games') iframe.src = 'games.html';
  else if (tab.url === 'coolio://settings') iframe.src = 'settings.html';
  else iframe.src = tab.url;
  iframe.dataset.index = idx;
  iframe.classList.toggle('active', idx === activeIndex);
  iframe.onload = () => {
    const thisIdx = +iframe.dataset.index, thisTab = tabs[thisIdx];
    if (!thisTab) return;
    if (thisTab.url.startsWith('coolio://')) {
      thisTab.name = {
        'coolio://new':      'New Tab',
        'coolio://games':    'Games',
        'coolio://settings': 'Settings'
      }[thisTab.url];
      thisTab.icon = customIcons[thisTab.url];
      saveAndRender();
    } else {
      const domain = new URL(thisTab.url).hostname;
      thisTab.icon = 'https://www.google.com/s2/favicons?domain=' + domain;
      saveAndRender();
      const checkTitle = () => {
        try {
          const t = iframe.contentDocument?.title;
          if (t) { thisTab.name = t; saveAndRender(); }
          else setTimeout(checkTitle, 500);
        } catch { setTimeout(checkTitle, 500); }
      };
      setTimeout(checkTitle, 1500);
    }
  };
  iframeContainer.appendChild(iframe);
  iframeElements[idx] = iframe;
}
function renderTabs() {
  tabsContainer.innerHTML = '';
  tabs.forEach((tab, i) => {
    const el = document.createElement('div');
    el.className = 'tab' + (i === activeIndex ? ' selected' : '');
    const favIcon = document.createElement('img');
    favIcon.className = 'icon';
    favIcon.src = tab.icon || 'img/logo.png';
    const label = document.createElement('span');
    label.textContent = tab.name || (() => { try { return new URL(tab.url).hostname.replace('www.', ''); } catch { return 'New Tab'; } })();
    const close = document.createElement('span');
    close.className = 'close';
    close.innerHTML = `<svg class="navb-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    close.onclick = e => {
      e.stopPropagation();
      iframeElements[i].remove();
      tabs.splice(i, 1);
      iframeElements.splice(i, 1);
      if (activeIndex >= tabs.length) activeIndex = tabs.length - 1;
      saveAndRender();
    };
    el.append(favIcon, label, close);
    el.onclick = () => switchToTab(i);
    tabsContainer.appendChild(el);
  });
  const addTab = document.createElement('div');
  addTab.className = 'add-tab';
  addTab.innerHTML = `<svg class="navb-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
  addTab.onclick = () => {
    tabs.push({ name: 'New Tab', url: 'coolio://new', icon: customIcons['coolio://new'] });
    activeIndex = tabs.length - 1;
    createIframe({ url: 'coolio://new' }, activeIndex);
    saveAndRender();
  };
  tabsContainer.appendChild(addTab);
}
function switchToTab(idx) {
  activeIndex = idx;
  localStorage.setItem('activeTab', activeIndex);
  iframeElements.forEach((ifr, i) => ifr.classList.toggle('active', i === idx));
  if (iframeElements[idx]) {
    const src = iframeElements[idx].src;
    if (src.includes('newtab.html')) urlInput.value = 'coolio://new';
    else if (src.includes('games.html')) urlInput.value = 'coolio://games';
    else if (src.includes('settings.html')) urlInput.value = 'coolio://settings';
    else urlInput.value = src;
  }
  updateTabTitle(idx);
  renderTabs();
}
function saveAndRender() {
  localStorage.setItem('tabs', JSON.stringify(tabs));
  renderTabs();
  switchToTab(activeIndex);
}
function updateTabTitle(idx) {
  try {
    const t = iframeElements[idx].contentDocument.title;
    if (t && t !== tabs[idx].name) {
      tabs[idx].name = t;
      saveAndRender();
    }
  } catch {}
}
urlInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    const formatted = formatURL(urlInput.value.trim());
    const iframeUrl = 'static/iframe.html#' + formatted;
    tabs[activeIndex].url = iframeUrl;
    iframeElements[activeIndex].src = iframeUrl;
    updateTabIcons();
    saveAndRender();
  }
});
$('backBtn').onclick = () => { try { iframeElements[activeIndex].contentWindow.history.back(); } catch {} };
$('forwardBtn').onclick = () => { try { iframeElements[activeIndex].contentWindow.history.forward(); } catch {} };
$('reloadBtn').onclick = () => { try { iframeElements[activeIndex].contentWindow.location.reload(); } catch {} };
const moreButton = $('moreButton'), dropdownMenu = $('dropdownMenu');
moreButton.onclick = () => dropdownMenu.classList.toggle('show');
window.onclick = e => { if (!e.target.closest('.more-button') && !e.target.closest('.dropdown')) dropdownMenu.classList.remove('show'); };
$('fullscreenBtn').onclick = () => {
  const ifr = iframeElements[activeIndex];
  if (ifr && !document.fullscreenElement) ifr.requestFullscreen();
  else if (document.fullscreenElement) document.exitFullscreen();
  dropdownMenu.classList.remove('show');
};
$('installAppBtn').onclick = () => {
  if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then(() => { deferredPrompt = null; }); }
  dropdownMenu.classList.remove('show');
};
$('newTabBtn').onclick = () => {
  tabs.push({ name: 'New Tab', url: 'coolio://new', icon: customIcons['coolio://new'] });
  activeIndex = tabs.length - 1;
  createIframe({ url: 'coolio://new' }, activeIndex);
  saveAndRender();
  dropdownMenu.classList.remove('show');
};
$('gamesBtn').onclick = () => {
  tabs.push({ name: 'Games', url: 'coolio://games', icon: customIcons['coolio://games'] });
  activeIndex = tabs.length - 1;
  createIframe({ url: 'coolio://games' }, activeIndex);
  saveAndRender();
  dropdownMenu.classList.remove('show');
};
$('settingsBtn').onclick = () => {
  tabs.push({ name: 'Settings', url: 'coolio://settings', icon: customIcons['coolio://settings'] });
  activeIndex = tabs.length - 1;
  createIframe({ url: 'coolio://settings' }, activeIndex);
  saveAndRender();
  dropdownMenu.classList.remove('show');
};
window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; });
tabs.forEach(createIframe);
saveAndRender();
$('url-input').addEventListener('focus', function() { this.select(); });
  </script>
</body>
</html>
