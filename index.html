<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="black">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coolio Web</title>
<link rel="icon" href="img/logo.png" type="image/png">
<style>
*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Segoe UI',sans-serif;background:#f9f9f9;color:#333;overflow:hidden}.container{padding:8px}.tabs{display:flex;gap:4px;margin-bottom:6px;flex-wrap:wrap}.tab,.add-tab{display:flex;align-items:center;padding:4px 8px;background:#fff;border-radius:6px;box-shadow:0 1px 2px rgba(0,0,0,0.1);cursor:pointer;font-size:13px;border:1px solid #eee;transition:background .3s,border .3s}.tab{padding:4px 16px;font-size:15px}.tab span{white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 65px;}.tab:hover,.add-tab:hover{background:#f0f0f0;border-color:#ddd}.tab.selected{background:#cce0ff;border:1px solid #4d94ff}.tab .close{margin-left:6px;color:#999;font-weight:bold;cursor:pointer}.tab .close:hover{color:#333}.url-bar-wrapper{display:flex;align-items:center;gap:4px;margin-bottom:8px}.nav-button,.more-button{background:#fff;border:1px solid #eee;padding:6px 9px;border-radius:4px;cursor:pointer;font-size:15px;transition:.3s}.more-button{padding:6px 13px}.nav-button:hover,.more-button:hover{background:#f0f0f0}.url-bar{flex-grow:1;padding:6px 10px;font-size:13px;border:1px solid #eee;border-radius:4px}.dropdown{position:absolute;background:#fff;border:1px solid #eee;border-radius:4px;padding:8px 6px;right:8px;top:74px;display:none;flex-direction:column;gap:4px;box-shadow:0 4px 6px rgba(0,0,0,0.1);z-index:1000}.dropdown.show{display:flex}.dropdown button{padding:4px 15px;border:none;background:transparent;border-radius:3px;cursor:pointer;text-align:left;font-size:14px;transition:.1s}.dropdown button:hover{background:#eee}.iframe-container{margin-top:10px;width:100%;height:calc(100vh - 94px);position:relative}.iframe-container iframe{width:100%;height:100%;border:none;background:#fff;border-radius:4px;position:absolute;top:0;left:0;display:none}.iframe-container iframe.active{display:block}.icon{width:16px;height:16px;margin-right:6px;vertical-align:middle}.divider{width:85%;height:1px;background:#ccc;margin:0 10px;display:inline-block}
</style>
</head>
<body>
<div class="container">
<div class="tabs" id="tabs"></div>
<div class="url-bar-wrapper">
<button class="nav-button" id="backBtn">&#8592;</button>
<button class="nav-button" id="forwardBtn">&#8594;</button>
<button class="nav-button" id="reloadBtn">&#10227;</button>
<input id="url-input" class="url-bar" type="text" placeholder="Search or enter a URL.">
<button class="more-button" id="moreButton">&#8942;</button>
</div>
<div class="dropdown" id="dropdownMenu">
<button id="newTabBtn"><img src="icons/newtab.png" class="icon">New Tab</button>
<div class="divider"></div>
<button id="fullscreenBtn"><img src="icons/fullscreen.png" class="icon">Fullscreen</button>
<button id="installAppBtn"><img src="icons/downloads.png" class="icon">Download App</button>
<div class="divider"></div>
<button><img src="icons/settings.png" class="icon">Settings</button>
</div>
<div class="iframe-container" id="iframeContainer"></div>
</div>
<script>
  function formatURL(input) {
    if (input.startsWith('http://') || input.startsWith('https://')) return input;
    if (input.includes('.') || input.includes(':')) return 'https://' + input;
    return 'https://duckduckgo.com/?q=' + encodeURIComponent(input);
  }

  window.addEventListener('message', function(e) {
    if (e.origin !== window.location.origin) return;

    if (e.data.type === 'search') {
      const searchQuery = e.data.query;
      document.getElementById('url-input').value = searchQuery;

      let formattedUrl = formatURL(searchQuery);
      tabs[activeIndex].url = 'static/iframe.html#' + formattedUrl;
      iframeElements[activeIndex].src = 'static/iframe.html#' + formattedUrl;
      updateTabInfo();
    }
  });

  let tabs = JSON.parse(localStorage.getItem('tabs')) || [],
      activeIndex = parseInt(localStorage.getItem('activeTab')) || 0,
      iframeElements = [];

  function updateURLBar(idx) {
    const currentIframe = iframeElements[idx];
    if (!currentIframe) return;

    const currentURL = currentIframe.src;
    const newURL = currentURL.includes('#') ? decodeURIComponent(currentURL.split('#')[1]) : decodeURIComponent(currentURL);

    if (urlInput.value !== newURL) {
      urlInput.value = newURL;
    }
  }

  function updateTabTitle(idx) {
    const currentIframe = iframeElements[idx];
    if (!currentIframe) return;

    try {
      const title = currentIframe.contentDocument.title;
      if (title && title !== tabs[idx].name) {
        tabs[idx].name = title;
        renderTabs();
      }
    } catch (e) {
      console.error(e);
    }
  }

  function createIframe(tab, idx) {
    const ifr = document.createElement('iframe');
    ifr.src = tab.url;
    ifr.dataset.index = idx;
    ifr.classList.add('iframe');
    ifr.classList.toggle('active', idx === activeIndex);
    iframeContainer.appendChild(ifr);
    iframeElements[idx] = ifr;
    ifr.onload = () => {
      updateTabTitle(idx);
    };
  }

  function renderTabs() {
    tabsContainer.innerHTML = '';
    tabs.forEach((tab, i) => {
      const el = document.createElement('div');
      el.className = 'tab' + (i === activeIndex ? ' selected' : '');

      const favIcon = document.createElement('img');
      favIcon.className = 'icon';
      favIcon.src = tab.icon || 'img/logo.png';

      const label = document.createElement('span');
      label.textContent = tab.name || 'New Tab';

      const close = document.createElement('span');
      close.textContent = 'Ã—';
      close.className = 'close';
      close.onclick = e => {
        e.stopPropagation();
        iframeElements[i].remove();
        tabs.splice(i, 1);
        iframeElements.splice(i, 1);
        if (activeIndex >= tabs.length) activeIndex = tabs.length - 1;
        saveAndRender();
      };

      el.appendChild(favIcon);
      el.appendChild(label);
      el.appendChild(close);
      el.onclick = () => switchToTab(i);
      tabsContainer.appendChild(el);
    });

    const addTab = document.createElement('div');
    addTab.className = 'add-tab';
    addTab.textContent = '+';
    addTab.onclick = () => {
      const url = 'newtab.html';
      tabs.push({ name: 'New Tab', url, icon: 'img/logo.png' });
      activeIndex = tabs.length - 1;
      createIframe({ url }, activeIndex);
      saveAndRender();
    };
    tabsContainer.appendChild(addTab);
  }

  function switchToTab(idx) {
    activeIndex = idx;
    localStorage.setItem('activeTab', activeIndex);
    iframeElements.forEach((ifr, i) => {
      ifr.classList.toggle('active', i === idx);
    });
    updateURLBar(idx);
    updateTabTitle(idx);
    renderTabs();
  }

  function saveAndRender() {
    localStorage.setItem('tabs', JSON.stringify(tabs));
    renderTabs();
    switchToTab(activeIndex);
  }

  function updateTabInfo() {
    for (let i = 0; i < tabs.length; i++) {
      const tab = tabs[i];
      if (tab.url.includes('newtab.html')) continue;

      let realURL = decodeURIComponent(tab.url.split('#')[1] || tab.url);

      try {
        const domain = (new URL(realURL)).hostname;
        tabs[i].icon = 'https://www.google.com/s2/favicons?domain=' + domain;
      } catch { 
        tabs[i].icon = 'img/logo.png';
      }
    }
    localStorage.setItem('tabs', JSON.stringify(tabs));
    renderTabs();
  }

  urlInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      let url = urlInput.value.trim();
      url = formatURL(url);
      tabs[activeIndex].url = 'static/iframe.html#' + url;
      iframeElements[activeIndex].src = 'static/iframe.html#' + url;
      updateTabInfo();
      updateURLBar(activeIndex);
    }
  });

  backBtn.onclick = () => iframeElements[activeIndex].contentWindow.history.back();
  forwardBtn.onclick = () => iframeElements[activeIndex].contentWindow.history.forward();
  reloadBtn.onclick = () => iframeElements[activeIndex].contentWindow.location.reload();
  moreButton.onclick = () => document.getElementById('dropdownMenu').classList.toggle('show');
  fullscreenBtn.onclick = () => iframeElements[activeIndex].requestFullscreen?.();
  installAppBtn.onclick = async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      deferredPrompt = null;
    }
  };

  if (!tabs.length) {
    tabs = [{ name: 'New Tab', url: 'newtab.html', icon: 'img/logo.png' }];
  }

  tabs.forEach((tab, i) => createIframe(tab, i));
  saveAndRender();
</script>



</body>
</html>
